name: dbt_test_base_tbl_zero_row_counts
on: [push]

env:
  DBT_PROJECT_NAME: "bikestores"
  DBT_MODEL: "curated_db"
  SNOWFLAKE_ACCOUNT: ${{ secrets.SNOWFLAKE_ACCOUNT }}
  SNOWFLAKE_USER: ${{ secrets.SNOWFLAKE_USER }}
  SNOWFLAKE_PASS: ${{ secrets.SNOWFLAKE_PASS }}
  SNOWFLAKE_ROLE: ${{ secrets.SNOWFLAKE_ROLE }}
  SNOWFLAKE_DB: "bikestores_curated_db"
  SNOWFLAKE_WH: "bikestores_developer_wh"
  SNOWFLAKE_SCHEMA: "production"

jobs:
  dbt:
    name: dbt
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - uses: actions/setup-python@v1
        with:
          python-version: "3.7.x"
      - run: pip3 install --upgrade dbt
      - run: dbt --version
      - run: cd bin/${DBT_PROJECT_NAME} && dbt debug --profiles-dir profiles
      - run: cd bin/${DBT_PROJECT_NAME} && dbt test --data --profiles-dir profiles --models ${DBT_MODEL}